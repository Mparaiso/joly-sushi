// Generated by CoffeeScript 1.3.3
var ProductCardController, ProductDetailController, ProductListController,
  __hasProp = {}.hasOwnProperty;

ProductListController = function($scope, $rootScope, $http, $filter) {
  /* gère l'affichage de la liste de produits
  */
  $rootScope.title = "Joly Sushi";
  return $scope.orderProp = 'price';
};

ProductDetailController = function($rootScope, $scope, $routeParams, $http) {
  /* gère l'affichage de vue de détail
  */
  $scope.sushiId = $routeParams["sushiId"];
  $scope.sushi = $rootScope.sushis.filter(function(data) {
    return data.id === parseInt($scope.sushiId, 10);
  })[0];
};

/* ProductDetailController.$inject = ['$scope',"$routeParams"]
*/


ProductCardController = function($scope, $rootScope, $routeParams, $http) {
  var getCard;
  $rootScope.card = {};
  $rootScope.cardIdList = [];
  $http.get('data/data.json').success(function(data) {
    return $rootScope.sushis = data;
  });
  $rootScope.getSushiById = function(id) {
    /* obtenir un sushi par son id
    */

    var sushi, _i, _len, _ref;
    _ref = $rootScope.sushis;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      sushi = _ref[_i];
      if (sushi.id === id) {
        return sushi;
      }
    }
  };
  getCard = function() {
    /* obtenir la carte courante
    */
    return $rootScope.cardIdList.reduce((function(a, b) {
      if (b in a) {
        a[b].quantity += 1;
      } else {
        a[b] = {
          quantity: 1,
          sushi: $rootScope.getSushiById(b)
        };
      }
      return a;
    }), {});
  };
  $rootScope.addToCard = function(sushiId) {
    /* ajouter un article à la carte
    */
    $rootScope.cardIdList.push(sushiId);
    return $rootScope.card = getCard();
  };
  $rootScope.getFullName = function(sushi) {
    return "" + sushi.type + " " + sushi.name;
  };
  $scope.getTotalPrice = function() {
    var article, card, prop, total;
    total = 0;
    card = $rootScope.card;
    for (prop in card) {
      if (!__hasProp.call(card, prop)) continue;
      article = card[prop];
      total += article.quantity * article.sushi.price;
    }
    return total;
  };
};
